<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bulk Email Validator</title>
  <link rel="stylesheet" href="/styles/index.css">
</head>
<body>
  <div class="container">
    <h1>Bulk Email Validator</h1>

    <% if (message) { %>
      <div id="formMessage" class="alert error"><%= message %></div>
    <% } else { %>
      <div id="formMessage" class="alert hidden"></div>
    <% } %>

    <form action="/validate" id="validateFormAjax" method="POST" enctype="multipart/form-data">
      <div class="form-group">
        <label for="emailFile">Upload CSV file:</label>
        <input type="file" name="emailFile" id="emailFile" accept=".csv">
      </div>

      <div class="form-group">
        <label for="manualEmails">Or enter emails manually (one per line or comma separated):</label>
        <textarea name="manualEmails" id="manualEmails" rows="6" placeholder="example1@gmail.com&#10;example2@yahoo.com"></textarea>
      </div>

      <button id="validateBtn" type="submit">Validate Emails</button>
      <div id="processing" class="hidden"><span class="spinner"></span> Processing...</div>
    </form>
  </div>

  <script>
      const form = document.getElementById('validateFormAjax');
      const fileInput = document.getElementById('emailFile');
      const textarea = document.getElementById('manualEmails');
      const btn = document.getElementById('validateBtn');
      const processing = document.getElementById('processing');
      const messageBox = document.getElementById('formMessage');

      form.addEventListener('submit', async function (e) {

        messageBox.textContent = "";
        messageBox.classList.add("hidden");

        const fileSelected = fileInput.files.length > 0;
        const manualText = textarea.value.trim();

        if (!fileSelected && !manualText) {
          e.preventDefault();
          messageBox.textContent = "⚠️ Please upload a CSV file or enter at least one email address.";
          messageBox.classList.remove("hidden");
          messageBox.classList.add("error");
          return;
        }
        else{
          const fd = new FormData(form);
          await fetch(form.action, { method: 'POST', body: fd });

          fileInput.disabled = true;
        textarea.disabled = true;
        btn.disabled = true;
        processing.classList.remove('hidden');

        }



       
      });
  </script>
</body>
</html>
